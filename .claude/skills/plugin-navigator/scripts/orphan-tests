#!/usr/bin/env bash
# List test files without corresponding plugins.
# Usage: orphan-tests

set -euo pipefail
source "$(dirname "${BASH_SOURCE[0]}")/lib/common.sh"

cd "$PROJECT_ROOT"

orphan_count=0

while IFS= read -r test_file; do
    basename="$(basename "$test_file")"
    [[ "$basename" == "test_helper.rb" ]] && continue

    if ! find_plugin_for_test "$test_file" > /dev/null; then
        echo "$test_file"
        orphan_count=$((orphan_count + 1))
    fi
done < <(find "$TESTS_DIR" -name "*.rb" | LC_ALL=C sort)

echo ""
echo "---"
if [[ $orphan_count -eq 0 ]]; then
    echo "No orphan tests found."
else
    echo "Total: $orphan_count orphan tests"
fi
