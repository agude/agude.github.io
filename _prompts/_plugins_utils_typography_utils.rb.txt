I need you to refactor the following Ruby file to fix RuboCop static analysis errors and improve general code quality.

FILE: _plugins/utils/typography_utils.rb

THE ERRORS TO FIX:
- Line 12: [Metrics/AbcSize] Assignment Branch Condition size for `prepare_display_title` is too high. [<2, 18, 1> 18.14/17]
- Line 12: [Metrics/MethodLength] Method has too many lines. [19/10]


STYLE GUIDE & REFACTORING PATTERNS:
1. **Complex Logic Extraction (Tags/Classes):**
   - If a method (like `render`) is too complex, extract the logic into a private helper class defined within the same module/class.
   - **Pattern:**
     ```ruby
     def render(context)
       MyTagRenderer.new(context).render
     end

     # Helper class to handle rendering logic
     class MyTagRenderer
       def initialize(context)
         @context = context
         @site = context.registers[:site]
       end

       def render
         # logic here
       end
     end
     ```

2. **Stateless Utilities (Modules):**
   - For utility modules, keep methods static (`def self.method`).
   - Break complex logic into private class methods named with a leading underscore.
   - **Pattern:**
     ```ruby
     def self.public_method(arg)
       _private_helper(arg)
     end

     def self._private_helper(arg)
       # logic
     end
     ```

3. **General Quality:**
   - Fix "bad code" or poor style even if RuboCop misses it (e.g., redundant logic, unclear variable names, deeply nested conditionals).
   - Ensure `# frozen_string_literal: true` is at the top.

INSTRUCTIONS:
1. Fix the specific RuboCop errors listed above.
2. Apply the Refactoring Patterns defined in the Style Guide.
3. Improve readability and maintainability generally.
4. **CRITICAL:** DO NOT change the external behavior or API of the code.
5. DO NOT remove comments unless they are the specific "rubocop:disable" comments causing issues.
6. Return the FULL content of the fixed file.

SOURCE CODE:
```ruby
# frozen_string_literal: true

# _plugins/utils/typography_utils.rb
require 'cgi' # Still needed for the initial minimal escape, though not for full CGI.escapeHTML

module TypographyUtils
  # Applies manual "SmartyPants"-like transformations, minimal HTML escaping,
  # and allows <br> tags through. NO Kramdown involved.
  # @param title [String, nil] The title string to prepare.
  # @return [String] The prepared title string, safe for HTML content.
  # Renamed from _prepare_display_title
  def self.prepare_display_title(title)
    return '' if title.nil?

    text = title.to_s

    # 1. Minimal HTML Escape FIRST (Only &, <, >)
    # Do this before typography to avoid escaping entities we create.
    # This will turn literal <br> into <br> and <Tags> into <Tags>
    escaped_text = text.gsub('&', '&amp;')
                       .gsub('<', '&lt;')
                       .gsub('>', '&gt;')

    # 2. Manual Typographic Transformations (Order matters for quotes)
    escaped_text.gsub!('---', '—')    # Em dash
    escaped_text.gsub!('--', '–')     # En dash
    escaped_text.gsub!('...', '…') # Ellipsis

    # Double quotes: “ ”
    # Match " preceded by space/start/(/[ or followed by word char
    escaped_text.gsub!(/(?<=\s|^|\[|\()"|"(?=\w)/, '“') # Opening "" (using lookbehind/lookahead)
    escaped_text.gsub!('"', '”') # Closing "" (remaining)

    # Single quotes: ‘ ’ - Apostrophes first
    escaped_text.gsub!(/(\w)'(\w)/, '\1’\2') # Apostrophe within word
    escaped_text.gsub!(/'(\d{2}s)/, '’\1') # Year abbreviations
    escaped_text.gsub!(/(\w)'(?=\s|$|,|\.|;|\?|!)/, '\1’') # Possessive at end
    # Match ' preceded by space/start/(/[ or followed by word char
    escaped_text.gsub!(/(?<=\s|^|\[|\()'|'(?=\w)/, '‘') # Opening ''
    escaped_text.gsub!('\'', '’') # Closing '' / Remaining apostrophes

    # 3. Restore literal <br> tags that were escaped in step 1
    # Ensure we match various forms of <br> that might have been escaped.
    escaped_text.gsub!('&lt;br&gt;', '<br>')
    escaped_text.gsub!('&lt;br/&gt;', '<br>')
    escaped_text.gsub!('&lt;br /&gt;', '<br>') # With space

    # Return the final text
    escaped_text
  end
end
```
