---
layout: default
---

<article class="page">
  <h1 class="page-title"><cite class="book-title">{{ page.title }}</cite></h1>

  {% if page.image %}
  <div class="book-cover-float-container">
    <img class="book-cover-lead"
      src="{{ page.image }}"
      alt="Book cover of {{ page.title }}."
    >
  </div>
  {% endif %}

  <!-- Book Metadata -->

  {% comment %} Authors {% endcomment %}
  {% assign authors_html_output = "" %}
  {% capture captured_authors_html %}
    {% display_authors page.book_authors %}
  {% endcapture %}
  {% assign authors_html_output = captured_authors_html | strip %}

  {% if authors_html_output != "" %}
    <div class="written-by">by {{ authors_html_output }}</div>
  {% endif %}

  {% comment %} Series {% endcomment %}
  {% if page.series and page.book_number %}
    <div class="book-series-line">
      Book {{page.book_number}} of {% series_text page.series %}
    </div>
  {% endif %}

  {% comment %} Awards and Favorites {% endcomment %}
  {%- assign favorites_cache = site.data.link_cache.favorites_mentions -%}
  {%- assign mentioning_posts = favorites_cache[page.url] | default: nil -%}

  {% if page.awards or mentioning_posts %}
    <div class="book-awards">Awards:
    {% if page.awards %}
        {% assign sorted_awards = page.awards | sort %}
        {% for award in sorted_awards %}
          <a class="book-award" href="/books/by-award/#{{ award | slugify }}-award">
            {%- assign words = award | split: ' ' -%}
            {%- for word in words %}
              {{ word | capitalize }}{%- unless forloop.last %} {% endunless -%}
            {% endfor -%}
          </a>{%- unless forloop.last -%}, {%- endunless -%}
        {% endfor %}
      {%- endif -%}

      {%- if page.awards and mentioning_posts -%}, {% endif -%}

      {%- if mentioning_posts -%}
        {%- assign sorted_posts = mentioning_posts | sort: "is_favorites_list" | reverse -%}
        {%- for post in sorted_posts -%}
          <a class="book-favorite-link" href="{{ post.url | relative_url }}">{{ post.is_favorites_list }} Favorites</a>{%- unless forloop.last -%}, {% endunless -%}
        {%- endfor -%}
      {%- endif -%}

    </div>
  {% endif %}

  {%- comment -%} On an ARCHIVED page, link back to its canonical version {%- endcomment -%}
  {%- if page.canonical_for and page.canonical_for != "" -%}
    <div class="archived-notice">
      This is an archived review from {{ page.date | date: '%B %d, %Y' }}.
      Read the <a href="{{ page.canonical_for | relative_url
      }}"><strong>current review</strong></a>.
    </div>
  {%- endif -%}

  <h2 class="book-review-headline">Review</h2>
  {% comment %}Add star rating, if one exists in the metadata{% endcomment %}
  {% if page.rating %}
    {% rating_stars page.rating %}
  {% endif %}

  {{ content }}

</article>

<hr>

{%- comment -%} On a CANONICAL page, list its archives using book cards {%- endcomment -%}
{%- assign archived_review_docs = "" | split: "" -%}
{%- for book in site.books -%}
  {%- if book.canonical_for == page.url -%}
    {%- assign archived_review_docs = archived_review_docs | push: book -%}
  {%- endif -%}
{%- endfor -%}

{%- if archived_review_docs.size > 0 -%}
  <aside class="previous-reviews">
    <h2 class="book-review-headline">Previous Reviews</h2>
    <div class="card-grid">
      {%- assign sorted_docs = archived_review_docs | sort: "date" | reverse -%}
      {%- for doc in sorted_docs -%}
        {%- capture card_subtitle -%}Review from {{ doc.date | date: '%B %d, %Y' }}{%- endcapture -%}
        {% render_book_card doc subtitle=card_subtitle %}
      {%- endfor -%}
    </div>
  </aside>
{%- endif -%}

<!-- Backlinks -->
{% book_backlinks %}

<!-- Related and Recent Books -->
{% related_books %}
